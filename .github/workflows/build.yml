name: Build LambdaNotes

on:
  push:
    branches: [ "main", "feat/*" ]
  release:
    types: [ created ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up JDK 23
      uses: actions/setup-java@v4
      with:
        java-version: '23'
        distribution: 'temurin'
        cache: maven

    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.24'
        # cache: true # Enable if go.sum exists

    - name: Install Build Tools
      run: |
        choco install launch4j
        choco install innosetup

    - name: Build Application (Installer & Portable)
      run: .\build_installer.ps1

    - name: Create Portable ZIP
      run: |  
        Compress-Archive -Path installer_output/LambdaNotes -DestinationPath LambdaNotes-Portable.zip

    - name: Upload Portable Artifact
      uses: actions/upload-artifact@v4
      with:
        name: LambdaNotes-Portable
        path: LambdaNotes-Portable.zip

    - name: Upload Installer Artifact
      uses: actions/upload-artifact@v4
      with:
        name: LambdaNotes-Setup
        path: installer_output/LambdaNotes_Setup.exe

    - name: Upload Release Assets
      if: github.event_name == 'release'
      uses: softprops/action-gh-release@v1
      with:
        files: |
          LambdaNotes-Portable.zip
          installer_output/LambdaNotes_Setup.exe
